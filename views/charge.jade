extends layout

block scripts
  script(type="text/javascript", src="https://js.stripe.com/v2/")
  script.
    Stripe.setPublishableKey('#{pk}');
    $(document).ready(function() {
      $("#charge-error").hide()
      $('#payment-form').submit(function(event) {
        $("#charge-error").hide()
        var $form = $(this);
        // Disable the submit button to prevent repeated clicks
        $form.find('button').prop('disabled', true);
        Stripe.card.createToken($form, stripeResponseHandler);
        // Prevent the form from submitting with the default action
        return false;
        });
    });
    function stripeResponseHandler(status, response) {
      if (response.error) {
        // show the errors on the form
        $("#charge-error").show()
        $(".payment-errors").text(response.error.message);
        $(".submit-button").removeAttr("disabled");
      } else {
        var form$ = $("#payment-form");
        // token contains id, last4, and card type
        var token = response['id'];
        // insert the token into the form so it gets submitted to the server
        form$.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");
        // and submit
        form$.get(0).submit();
      }
    }

block content
  .container              
    br
    a(href="/") Back home
    br
    br
    h4 Use this data for testing: 
    ul
      li Card Number - 4242424242424242
      li CVC Code - any three digits
      li Expiration - any date in the future
    h2 One time payment
    form#payment-form(role='form', action='/stripe', method='POST', style='max-width: 300px;')
      #charge-error.alert.alert-danger.payment-errors
      .form-row
        label Credit Card Info
        input.card-number.form-control(type='text', autocomplete='off', data-stripe='number', placeholder='Card Number')
      .form-row
        input.card-cvc.form-control(type='text', autocomplete='off', data-stripe='cvc', placeholder='CVC Code')
      .form-row
        label Expiration Date
        br
        input.card-expiry-month.form-control(type='text', data-stripe='exp-month', placeholder='MM')
        input.card-expiry-year.form-control(type='text', data-stripe='exp-year', placeholder='YYYY')
      br
      button.btn.btn-default.submit-button.btn-block(type='submit') Submit Payment

